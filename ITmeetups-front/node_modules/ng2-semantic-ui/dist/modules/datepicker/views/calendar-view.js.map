{"version":3,"file":"calendar-view.js","sourceRoot":"","sources":["../../../../src/modules/datepicker/views/calendar-view.ts"],"names":[],"mappings":"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","sourcesContent":["import { Input, QueryList, ViewChildren, AfterViewInit, HostListener, Renderer2, OnDestroy } from \"@angular/core\";\r\nimport { KeyCode } from \"../../../misc/util/index\";\r\nimport { CalendarItem, SuiCalendarItem } from \"../directives/calendar-item\";\r\nimport { CalendarService } from \"../services/calendar.service\";\r\nimport { CalendarRangeService } from \"../services/calendar-range.service\";\r\n\r\nexport enum CalendarViewType {\r\n    Year = 0,\r\n    Month = 1,\r\n    Date = 2,\r\n    Hour = 3,\r\n    Minute = 4\r\n}\r\nexport type CalendarViewResult = [Date, CalendarViewType];\r\n\r\nexport abstract class CalendarView implements AfterViewInit, OnDestroy {\r\n    private _type:CalendarViewType;\r\n    private _service:CalendarService;\r\n\r\n    @ViewChildren(SuiCalendarItem)\r\n    private _renderedItems:QueryList<SuiCalendarItem>;\r\n    private _highlightedItem?:CalendarItem;\r\n\r\n    @Input()\r\n    public set service(service:CalendarService) {\r\n        this._service = service;\r\n        this.ranges.loadService(service);\r\n\r\n        this.service.onManualUpdate = () => {\r\n            this.ranges.refresh();\r\n\r\n            delete this._highlightedItem;\r\n            this.autoHighlight();\r\n        };\r\n    }\r\n\r\n    public get service():CalendarService {\r\n        return this._service;\r\n    }\r\n\r\n    public ranges:CalendarRangeService;\r\n\r\n    public get currentDate():Date {\r\n        return this.service.currentDate;\r\n    }\r\n\r\n    public get selectedDate():Date | undefined {\r\n        return this.service.selectedDate;\r\n    }\r\n\r\n    private _documentKeyDownListener:() => void;\r\n\r\n    constructor(renderer:Renderer2, viewType:CalendarViewType, ranges:CalendarRangeService) {\r\n        this._type = viewType;\r\n        this.ranges = ranges;\r\n\r\n        this._documentKeyDownListener = renderer.listen(\"document\", \"keydown\", (e:KeyboardEvent) => this.onDocumentKeyDown(e));\r\n    }\r\n\r\n    // Template Methods\r\n\r\n    public setDate(item:CalendarItem):void {\r\n        this.service.changeDate(item.date, this._type);\r\n    }\r\n\r\n    public zoomOut():void {\r\n        this.service.zoomOut(this._type);\r\n    }\r\n\r\n    // Keyboard Control\r\n\r\n    public ngAfterViewInit():void {\r\n        this._renderedItems.changes.subscribe(() => this.onRenderedItemsChanged());\r\n        this.onRenderedItemsChanged();\r\n    }\r\n\r\n    private onRenderedItemsChanged():void {\r\n        this._renderedItems.forEach(i =>\r\n            i.onFocussed.subscribe((hasFocus:boolean) => {\r\n                if (hasFocus) {\r\n                    this.highlightItem(i.item);\r\n                }\r\n            }));\r\n\r\n        this.autoHighlight();\r\n        this.highlightItem(this._highlightedItem);\r\n    }\r\n\r\n    private autoHighlight():void {\r\n        let date = this.selectedDate && this.ranges.current.containsDate(this.selectedDate) ? this.selectedDate : this.currentDate;\r\n        if (this._highlightedItem && this.ranges.current.containsDate(this._highlightedItem.date)) {\r\n            date = this._highlightedItem.date;\r\n        }\r\n\r\n        const initiallyHighlighted = this.ranges.current.items.find(i => this.ranges.dateComparer.equal(i.date, date));\r\n        if (initiallyHighlighted && !initiallyHighlighted.isDisabled) {\r\n            this._highlightedItem = initiallyHighlighted;\r\n        }\r\n    }\r\n\r\n    private highlightItem(item:CalendarItem | undefined):void {\r\n        if (item) {\r\n            this._renderedItems.forEach(i => i.hasFocus = false);\r\n            const rendered = this._renderedItems.find(ri => ri.item === item);\r\n            if (rendered && !rendered.hasFocus) {\r\n                rendered.hasFocus = true;\r\n                rendered.changeDetector.detectChanges();\r\n            }\r\n\r\n            this._highlightedItem = item;\r\n        }\r\n    }\r\n\r\n    private onDocumentKeyDown(e:KeyboardEvent):void {\r\n        if (this._highlightedItem && e.keyCode === KeyCode.Enter) {\r\n            this.setDate(this._highlightedItem);\r\n            return;\r\n        }\r\n\r\n        if (!this._highlightedItem) {\r\n            this.autoHighlight();\r\n        }\r\n\r\n        const index = this.ranges.current.findIndex(this._highlightedItem);\r\n        let isMovingForward = true;\r\n        let delta = 0;\r\n\r\n        switch (e.keyCode) {\r\n            case KeyCode.Right:\r\n                delta += 1;\r\n                break;\r\n            case KeyCode.Left:\r\n                delta -= 1;\r\n                isMovingForward = false;\r\n                break;\r\n            case KeyCode.Down:\r\n                delta += this.ranges.columns;\r\n                break;\r\n            case KeyCode.Up:\r\n                delta -= this.ranges.columns;\r\n                isMovingForward = false;\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n\r\n        // Stop these keypresses being captured elsewhere.\r\n        e.preventDefault();\r\n\r\n        let nextItem = this.ranges.current.items[index + delta];\r\n\r\n        if (nextItem && nextItem.isDisabled) {\r\n            return;\r\n        }\r\n\r\n        if (nextItem && !nextItem.isOutsideRange) {\r\n            return this.highlightItem(nextItem);\r\n        }\r\n\r\n        if (nextItem && nextItem.isOutsideRange) {\r\n            if (index + delta >= this.ranges.current.inRange.length) {\r\n                isMovingForward = true;\r\n            }\r\n        }\r\n\r\n        if (!nextItem) {\r\n            let adjustedIndex = this.ranges.current.findIndex(this._highlightedItem);\r\n\r\n            const nextItems = this.ranges.calc(isMovingForward).inRange;\r\n\r\n            if (isMovingForward) {\r\n                adjustedIndex -= this.ranges.current.inRange.length;\r\n            } else {\r\n                adjustedIndex += nextItems.length;\r\n            }\r\n\r\n            nextItem = nextItems[adjustedIndex + delta];\r\n\r\n            if (nextItem.isDisabled) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.ranges.move(isMovingForward);\r\n        this._highlightedItem = this.ranges.current.find(nextItem);\r\n    }\r\n\r\n    public ngOnDestroy():void {\r\n        this._documentKeyDownListener();\r\n    }\r\n}\r\n"]}